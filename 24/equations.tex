\documentclass{article}
\usepackage{amsmath}
\begin{document}



\section{Part 1 - XY trajectory intersection}

Trajectories intersect when $X_a = X_b$ and $Y_a = Y_b$

Positions for each hailstone can be calculated:

\begin{displaymath}
    X = X_0 + V_x \times t
\end{displaymath}
\begin{displaymath}
    Y = Y_0 + V_y \times t
\end{displaymath}


This can be expressed by system of equations:
\begin{equation} \label{eq:1}
    \begin{cases}
    X_{a0} + V_{ax} \times t_a = X_{b0} + V_{bx} \times t_b \\
    Y_{a0} + V_{ay} \times t_a = Y_{b0} + V_{by} \times t_b
    \end{cases}
\end{equation}

\subsection{Solve by Elimination of variables}

Rearange $V \times t$
\begin{displaymath}
    \begin{cases}
    V_{ax} \times t_a = X_{b0} + V_{bx} \times t_b - X_{a0} \\
    V_{ay} \times t_a = Y_{b0} + V_{by} \times t_b - Y_{a0}
    \end{cases}
\end{displaymath}

Extract $t_a$
\begin{displaymath}
    \begin{cases}
    t_a = \frac{X_{b0} + V_{bx} \times t_b - X_{a0}}{V_{ax}} \\
    t_a = \frac{Y_{b0} + V_{by} \times t_b - Y_{a0}}{V_{ay}}
    \end{cases}
\end{displaymath}

Both sides
\begin{displaymath}
    \frac{X_{b0} + V_{bx} \times t_b - X_{a0}}{V_{ax}} = \frac{Y_{b0} + V_{by} \times t_b - Y_{a0}}{V_{ay}}
\end{displaymath}

Rearange fractions
\begin{displaymath}
    \frac{X_{b0} - X_{a0}}{V_{ax}} + \frac{V_{bx} \times t_b}{V_{ax}} = \frac{Y_{b0} - Y_{a0}}{V_{ay}} + \frac{V_{by} \times t_b}{V_{ay}}
\end{displaymath}
    

Move consts to right, vars to left
\begin{displaymath}
    \frac{V_{bx} \times t_b}{V_{ax}} - \frac{V_{by} \times t_b}{V_{ay}} = \frac{Y_{b0} - Y_{a0}}{V_{ay}} - \frac{X_{b0} - X_{a0}}{V_{ax}}
\end{displaymath}
    

Extact $t_b$
\begin{displaymath}
    t_b \times (\frac{V_{bx}}{V_{ax}} - \frac{V_{by}}{V_{ay}}) = \frac{Y_{b0} - Y_{a0}}{V_{ay}} - \frac{X_{b0} - X_{a0}}{V_{ax}}
\end{displaymath}


Re-arrange subtractions:
\begin{displaymath}
    t_b \times (\frac{V_{bx} \times V_{ay} - V_{by} \times V_{ax}}{V_{ax} \times V_{ay}}) = \frac{(Y_{b0} - Y_{a0}) \times V_{ax} - (X_{b0} - X_{a0}) \times V_{ay}}{V_{ax} \times V_{ay}}
\end{displaymath}

Extact $t_b$
\begin{displaymath}
    t_b = \frac{\frac{(Y_{b0} - Y_{a0}) \times V_{ax} - (X_{b0} - X_{a0}) \times V_{ay}}{V_{ax} \times V_{ay}}}{\frac{V_{bx} \times V_{ay} - V_{by} \times V_{ax}}{V_{ax} \times V_{ay}}}
\end{displaymath}

Simplify
\begin{equation} \label{eq:2}
    t_b = \frac{(Y_{b0} - Y_{a0}) \times V_{ax} - (X_{b0} - X_{a0}) \times V_{ay}}{V_{bx} \times V_{ay} - V_{by} \times V_{ax}}
\end{equation}

Rearranging (\ref{eq:1}) for b:
\begin{displaymath}
    \begin{cases}
    V_{bx} \times t_b = X_{a0} + V_{ax} \times t_a - X_{b0} \\
    V_{by} \times t_b = Y_{a0} + V_{ay} \times t_a - Y_{b0}
    \end{cases}
\end{displaymath}

Which is symmetric, so the expression for $t_a$ must be similar to (\ref{eq:2}), with a and b swapped:
\begin{displaymath}
    t_a = \frac{(Y_{a0} - Y_{b0}) \times V_{bx} - (X_{a0} - X_{b0}) \times V_{by}}{V_{ax} \times V_{by} - V_{ay} \times V_{bx}}
\end{displaymath}

Programmatically it would probably be easier to just swap the input variables. Anyway, we're only interested in situations when $t_a > 0$ and $t_b > 0$.
Additionally we're interested ony on $V_{bx} \times V_{ay} \neq V_{by} \times V_{ax}$, because otherwise these are parallel lines.

To determine if there will be an intersection at some point, we should calculate both divisor and divident and compare their signs.

Additional requirement was to determine if they will intersect inside some range of coordinates, so we have to actually calculate the
point of intersection. As there are large numbers and I'd like to avoid floating-point imprecisions as much as possible, let's try to plug the
formula for $t_b$ into the coordinate calculations and see if it could be simplified.



\begin{displaymath}
    X_b = X_{0b} + V_{bx} \times t_b
\end{displaymath}


\begin{displaymath}
    X_b = X_{0b} + V_{bx} \times \frac{(Y_{b0} - Y_{a0}) \times V_{ax} - (X_{b0} - X_{a0}) \times V_{ay}}{V_{bx} \times V_{ay} - V_{by} \times V_{ax}}
\end{displaymath}


Ok, it does not look like it can be simplified much, let's only multiply the dividend with $V_{bx}$ first.

\begin{displaymath}
    X_b = X_{0b} + \frac{V_{bx} \times ((Y_{b0} - Y_{a0}) \times V_{ax} - (X_{b0} - X_{a0}) \times V_{ay})}{V_{bx} \times V_{ay} - V_{by} \times V_{ax}}
\end{displaymath}

On the other hand, multiplying dividend with $V_{bx}$ may lead to integer overflow. One might try to risk with floating point imprecisions instead.

The perfect solution calls for math utilizing longer than 64-bit integers and some additional logic if intersection happens to be exactly on
the border.









\end{document}
